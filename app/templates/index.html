{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
{% if current_user %}
{% set nav_theme = 'light' %}
  {% include "partials/nav.html" %}
{% endif %}
<main class="layout-page" data-helpdesk-form-only>
  <header data-animate="fade">
    <h1 class="hero-title">{{ title }}</h1>
    <p class="hero-subtitle">Create support tickets with all the context your IT team needs. Focus on the request, we handle routing behind the scenes.</p>
  </header>
  <section class="surface-card" data-animate="fade">
    <form data-helpdesk-form>
        <h2 class="surface-card__title">Capture a new ticket</h2>
        <div class="field">
          <label for="subject">Subject</label>
          <input id="subject" name="subject" type="text" placeholder="Brief summary" required>
        </div>

        <div class="field">
          <label for="description">Description</label>
          <textarea id="description" name="description" placeholder="Describe the issue with steps to reproduce" required></textarea>
        </div>

        <div class="input-inline">
          <div class="field">
            <label for="issue_type">Issue Type</label>
            <select id="issue_type" name="issue_type" data-helpdesk-issue required>
              <option value="" disabled selected>Choose an issue type</option>
              {% for issue in issue_types %}
                <option value="{{ issue }}">{{ issue.replace('_', ' ') | title }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="field">
            <label for="priority">Priority</label>
            <select id="priority" name="priority" required>
              {% for priority in priorities %}
                <option value="{{ priority }}">{{ priority.title() }}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div class="dynamic-field" data-issue="login_issue">
          <h3>Login diagnostics</h3>
          <div class="field">
            <label for="context_username">Impacted username</label>
            <input id="context_username" name="context_username" type="text" data-context-field placeholder="user@company.com">
          </div>
          <div class="field">
            <label for="context_2fa">Two-factor steps attempted</label>
            <textarea id="context_2fa" name="context_2fa" data-context-field rows="2"></textarea>
          </div>
        </div>

        <div class="dynamic-field" data-issue="network">
          <h3>Network checklist</h3>
          <div class="field">
            <label for="context_location">Location or office</label>
            <input id="context_location" name="context_location" type="text" data-context-field placeholder="HQ - Floor 3">
          </div>
          <div class="field">
            <label for="context_devices">Devices affected</label>
            <textarea id="context_devices" name="context_devices" data-context-field rows="2" placeholder="Laptop, VOIP phone"></textarea>
          </div>
        </div>

        <div class="dynamic-field" data-issue="hardware">
          <h3>Hardware notes</h3>
          <div class="field">
            <label for="context_asset">Asset tag / serial</label>
            <input id="context_asset" name="context_asset" type="text" data-context-field placeholder="FH-2194">
          </div>
        </div>

        <div class="field">
          <label for="requester">Requester</label>
          <input id="requester" name="requester" type="text" placeholder="Who raised this ticket?" required>
        </div>

        <div class="field">
          <label for="assignee">Assignee <span class="field-optional">(optional)</span></label>
          <input id="assignee" name="assignee" type="text" placeholder="Assign instantly or leave blank">
        </div>

        <button type="submit" class="button button-primary">Submit ticket</button>
        <p class="form-status" data-form-status role="status"></p>
      </form>
  </section>
</main>
{% endblock %}

{% block scripts %}
  <script src="/static/scripts/helpdesk-form.js" defer></script>
{% endblock %}
