{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
{% include "partials/nav.html" %}
<main class="layout-page" data-admin-dashboard data-statuses='{{ statuses | tojson | safe }}' data-priorities='{{ priorities | tojson | safe }}' data-initial-stats='{{ stats | tojson | safe }}'>
  <section class="surface-card" data-animate="fade">
    <div class="surface-card__header">
      <div>
        <h1 class="hero-title">{{ title }}</h1>
        <p class="surface-card__meta">Monitor live ticket flow, adapt SLAs, and act on blocked work in real time.</p>
      </div>
      <a class="button button-secondary" href="/desk">Back to intake</a>
    </div>
  </section>

  <section class="card-grid" data-animate="fade">
    <article class="surface-card">
      <div class="surface-card__header">
        <h2 class="surface-card__title">Ticket health</h2>
        <span class="flash" data-slot="stats-flash"></span>
      </div>
      <div class="stat-grid" data-slot="stats-grid"></div>
      <h3 class="surface-card__title">Filters</h3>
      <div class="input-inline">
        <div class="field">
          <label for="filter-status">Status</label>
          <select id="filter-status" data-filter="status">
            <option value="all">All statuses</option>
            {% for status in statuses %}
              <option value="{{ status }}">{{ status.replace('_', ' ') | title }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="field">
          <label for="filter-priority">Priority</label>
          <select id="filter-priority" data-filter="priority">
            <option value="all">All priorities</option>
            {% for priority in priorities %}
              <option value="{{ priority }}">{{ priority.title() }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="field">
          <label for="search-term">Search</label>
          <input id="search-term" type="search" placeholder="Subject, requester, issue type" data-filter="term">
        </div>
      </div>
    </article>

    <aside class="surface-card is-hidden" data-panel="detail">
      <div class="surface-card__header">
        <div>
          <p class="status-pill" data-detail="status-pill"></p>
          <h3 class="surface-card__title" data-detail="subject"></h3>
        </div>
        <button type="button" class="button button-tertiary" data-detail="close">Close</button>
      </div>
      <p class="flash" data-detail="flash"></p>
      <div class="surface-card__meta" data-detail="meta"></div>
      <form data-detail="form" class="input-group">
        <div class="field">
          <label for="detail-status">Status</label>
          <select id="detail-status" data-detail="status"></select>
        </div>
        <div class="field">
          <label for="detail-assignee">Assignee</label>
          <input id="detail-assignee" type="text" placeholder="Assign owner" data-detail="assignee">
        </div>
        <div class="field">
          <label for="detail-resolution">Resolution notes</label>
          <textarea id="detail-resolution" placeholder="Add or adjust handoff notes" data-detail="resolution"></textarea>
        </div>
        <div class="button-row">
          <button type="submit" class="button button-primary">Save changes</button>
          <button type="button" class="button button-secondary" data-detail="resolve">Mark resolved</button>
        </div>
      </form>
    </aside>
  </section>

  <section class="surface-card" data-animate="fade">
    <div class="surface-card__header">
      <h2 class="surface-card__title">Tickets</h2>
      <span class="flash" data-slot="table-flash"></span>
    </div>
    <div class="table-wrapper">
      <table class="table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Requester</th>
            <th>Status</th>
            <th>Priority</th>
            <th>Assignee</th>
            <th>Updated</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody data-slot="ticket-table"></tbody>
      </table>
    </div>
  </section>

  <template data-template="ticket-row">
    <tr>
      <td data-cell="subject"></td>
      <td data-cell="requester"></td>
      <td><span class="status-pill" data-cell="status"></span></td>
      <td><span class="priority-pill" data-cell="priority"></span></td>
      <td data-cell="assignee"></td>
      <td data-cell="updated"></td>
      <td><button type="button" class="button button-secondary" data-action="manage">Manage</button></td>
    </tr>
  </template>
</main>
{% endblock %}

{% block scripts %}
  <script src="/static/scripts/admin-dashboard.js" defer></script>
{% endblock %}
